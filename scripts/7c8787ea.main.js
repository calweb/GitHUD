var docCookies={getItem:function(a){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=1/0===c?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},removeItem:function(a,b,c){return a&&this.hasItem(a)?(document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0):!1},hasItem:function(a){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=0;b<a.length;b++)a[b]=decodeURIComponent(a[b]);return a}};GitHUD.utilities.responsive={width:function(a){var a=a||{};return window.innerWidth<=768&&"smallLinechart"==a?350:window.innerWidth>768&&"smallLinechart"==a?452:window.innerWidth<=768&&"smallDonut"==a?70:window.innerWidth>768&&"smallDonut"==a?110:void 0},height:function(a){var a=a||{};return window.innerWidth<=768&&"smallLinechart"==a?120:window.innerHeight>1024&&"smallLinechart"==a?150:window.innerHeight<=1024&&"smallDonut"==a?70:window.innerHeight>1024&&"smallDonut"==a?110:void 0},ipadDonut:function(a){console.log("ipad donut responsive width called, innerWidth: ",window.innerWidth);var a=a||{};return window.innerWidth>970&&window.innerWidth<990&&"ipadDonutChart"==a?200:void 0},ipadLinechart:function(a){console.log("ipad linechart responsive width called, innerWidth",window.innerWidth);var a=a||{};return window.innerWidth>970&&window.innerWidth<990&&"ipadLinechart"==a?240:void 0}},GitHUD.utilities.keys=function(){return GitHUD.access_token?"?access_token="+GitHUD.access_token+"&per_page=100":""},GitHUD.utilities.colorTable={},GitHUD.utilities.color=function(a){var b=["#B82424","#13747D","#981F6E","#777CD8","#AADCD3","#FF7431","#6DDD7E","#FBA625","#B3CC57","#EF746F","#AB3E5B"];return GitHUD.utilities.colorTable[a]||(GitHUD.utilities.colorTable[a]=_.sample(b))},GitHUD.utilities.colorLuminance=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},GitHUD.Models.Repo=Backbone.Model.extend({url:function(){return"https://api.github.com/repos/"+this.get("full_name")+"/stats/contributors"+GitHUD.utilities.keys()},parse:function(a){var b,c,d=[],e=[],f=[],g={additions:{labels:[],datasets:[{fillColor:"#0086cb",strokeColor:"#00598a",pointColor:"#00598a",pointStrokeColor:"#fff",data:[]}]},deletions:{labels:[],datasets:[{fillColor:"#0086cb",strokeColor:"#00598a",pointColor:"#00598a",pointStrokeColor:"#fff",data:[]}]}},h={labels:[],datasets:[{fillColor:"#0086cb",strokeColor:"#00598a",pointColor:"#00598a",pointStrokeColor:"#fff",data:[]}]},i={allCommiters:{allTime:[],weekly:[]},topCommiter:{weekly:{},allTime:{}},ttlAdditions:0,ttlDeletions:0,ttlCommits:0,forks:0};return _.each(a,function(a){var b=GitHUD.utilities.color(a.author.login);d.push(a.total),e.push({username:a.author.login,color:b}),i.allCommiters.allTime.push({user:a.author.login,commits:a.total}),i.allCommiters.weekly.push({user:a.author.login,startOfWeek:moment(1e3*_.last(a.weeks).w).format("MMM-DD"),commits:_.last(a.weeks).c}),i.topCommiter.allTime=_.max(i.allCommiters.allTime,function(a){return a.commits}),i.topCommiter.weekly=_.max(i.allCommiters.weekly,function(a){return a.commits}),f.push({value:a.total,color:b}),_.each(a.weeks,function(a){i.ttlCommits+=a.c,i.ttlAdditions+=a.a,i.ttlDeletions+=a.d,h.datasets[0].data.push(a.c),g.additions.labels.push(""),g.deletions.labels.push(""),g.additions.datasets[0].data.push(a.a),g.deletions.datasets[0].data.push(a.d),h.labels.push("")})}),h.truncatedWeeklyData={},h.truncatedWeeklyData.datasets=h.datasets,h.truncatedWeeklyData.labels=["","","","","","","","","","","",""],h.truncatedWeeklyData.datasets[0]={data:_.last(h.datasets[0].data,12)},b={commitCount:_.reduce(d,function(a,b){return a+b},0),contribCount:e.length,additions:i.ttlAdditions,deletions:i.ttlDeletions,repoSize:this.get("size")},c={sortData:b,contributors:e,commits:d,donutData:f,graphData:h,tickerData:i,fsLinechart:g,authors:a},this.secondaryAjax(c),{gitHUDMeta:c}},secondaryAjax:function(a){var b="https://api.github.com/repos/"+this.get("full_name")+"/commits"+GitHUD.utilities.keys(),c=this;$.getJSON(b,function(b){var c={commitInfo:b};$.extend(a,c)}).done(function(){c.getLatestCommitStats(a)})},getLatestCommitStats:function(a){var b=a.commitInfo[0].url+GitHUD.utilities.keys();$.getJSON(b,function(b){null==b.author&&(b.author={login:"Unknown"}),b.commitMessage=a.commitInfo[0].commit.message;var c={latestCommit:b};$.extend(a,c)})}}),GitHUD.Models.User=Backbone.Model.extend({url:function(){return"https://api.github.com/users/"+this.get("username")+"/repos"+GitHUD.utilities.keys()},parse:function(a){return{repos:a}}}),GitHUD.Collections.UserCollection=Backbone.Collection.extend({model:GitHUD.Models.User,initialize:function(){console.log("new UserCollection created")}}),GitHUD.Views.FullScreenView=Backbone.View.extend({events:{"click #exit-fullscreen":"exitFullscreen","click #startSlideshow":"initFsSlideShow","click #nextSlide":"navigateSlide","click #previousSlide":"navigateSlide","click #previousRepo":"navigateRepos","click #nextRepo":"navigateRepos"},initialize:function(a){$(".donut-stage").css("display","none"),this.navObj=a.navObj||{},$("#sort-by").hide(),$(".slideshow-controls").show(),$(".fullscreen-stage").append(this.el),this.render();var b=_.bind(this.drawLinechart,this),c=_.throttle(b,200,{leading:!1});$(window).resize(c),this.initMarquee()},render:function(){renderedTemplate=JST["app/templates/fullscreen.html"]({repo:this.model}),tickerTemplate=JST["app/templates/ticker.html"]({repo:this.model}),this.$el.append(renderedTemplate),$(".fullscreen-ticker").append(tickerTemplate);var a=$("#donut-chart-"+this.model.get("id")).get(0).getContext("2d");new Chart(a).Doughnut(this.model.get("gitHUDMeta").donutData,{animation:!1}),this.drawLinechart(),this.initFsSlideShow({autoplay:!0})},linechartLegend:function(a){a=a||{},linechartLegendTemplate=JST["app/templates/linechartLegend.html"]({legend:a,repo:this.model}),$(".legend-destination").append(linechartLegendTemplate)},drawLinechart:function(){var a={catagory:"COMMITS",icon:"ss-loading",dataCount:this.model.get("gitHUDMeta").tickerData.ttlCommits},b=JST["app/templates/fullscreen-linechart.html"]({repo:this.model});this.linechartLegend(a),$(".legend").addClass("legendIn"),$(".legend-DELETIONS").addClass("legendOut"),$(".linechart-destination").append(b);var c=$("#line-chart-"+this.model.get("id")).get(0).getContext("2d"),d=_.max(this.model.get("gitHUDMeta").graphData.truncatedWeeklyData.datasets[0].data,function(a){return a});d>9?new Chart(c).Line(this.model.get("gitHUDMeta").graphData.truncatedWeeklyData,{scaleShowGridLines:!1,scaleSteps:5,scaleStepWidth:Math.floor(d/5),scaleStartValue:0,scaleOverride:!0,animation:!0}):new Chart(c).Line(this.model.get("gitHUDMeta").graphData.truncatedWeeklyData,{scaleShowGridLines:!1,scaleSteps:5,scaleStepWidth:2,scaleStartValue:0,scaleOverride:!0,animation:!0})},exitFullscreen:function(){clearInterval(window.intId),clearInterval(window.repoSlideshowInt),$("#sort-by").show(),$(".slideshow-controls").hide(),this.$el.remove(),$(".donut-stage").css("display","inline-block"),this.resetHeader()},initMarquee:function(){console.log("fuck")},headerColor:function(){$(".left-menu").css("background",GitHUD.utilities.colorLuminance(this.model.get("userColor"),-.2)),$(".left-menu h1").css({color:"#fff","text-shadow":"none"}),$(".left-menu button").css({color:"#fff","text-shadow":"none"})},resetHeader:function(){$(".left-menu").removeAttr("style"),$(".left-menu h1").removeAttr("style"),$(".left-menu button").removeAttr("style")},additionsSlide:function(a,b){$(".linechart-destination").html("");var a=this,c={catagory:"ADDITIONS",icon:"ss-plus",dataCount:a.model.get("gitHUDMeta").tickerData.ttlAdditions};a.linechartLegend(c),$(".linechart-destination").append(b);var d=$("#line-chart-"+a.model.get("id")).get(0).getContext("2d"),e=_.max(a.model.get("gitHUDMeta").fsLinechart.additions.datasets[0].data,function(a){return a});new Chart(d).Line(a.model.get("gitHUDMeta").fsLinechart.additions,{scaleShowGridLines:!1,scaleSteps:5,scaleStepWidth:Math.floor(e/5),scaleStartValue:0,scaleOverride:!0,animation:!0})},deletionsSlide:function(a,b){var a=this;$(".linechart-destination").html(""),$(".fsLegend").addClass("legendOut");var c={catagory:"DELETIONS",icon:"ss-delete",dataCount:a.model.get("gitHUDMeta").tickerData.ttlDeletions};a.linechartLegend(c),$(".legend-ADDITIONS").addClass("legendOut"),$(".linechart-destination").append(b);var d=$("#line-chart-"+a.model.get("id")).get(0).getContext("2d"),e=_.max(a.model.get("gitHUDMeta").fsLinechart.deletions.datasets[0].data,function(a){return a});new Chart(d).Line(a.model.get("gitHUDMeta").fsLinechart.deletions,{scaleShowGridLines:!1,scaleSteps:5,scaleStepWidth:Math.floor(e/5),scaleStartValue:0,scaleOverride:!0,animation:!0})},initFsSlideShow:function(a,b){GitHUD.slideCounter=a.counter||1;var c=this;this.headerColor();var d=JST["app/templates/fullscreen-linechart.html"]({repo:this.model});1==a.autoplay||"play"==$(event.target).data("slideshow")?($(".ss-play").css("display","none"),$(".ss-pause").css("display","inline-block"),this.repoSlideshow(),window.intId=setInterval(function(){1==GitHUD.slideCounter?($(".fsLegend").addClass("legendOut"),c.additionsSlide(c,d),GitHUD.slideCounter+=1):2==GitHUD.slideCounter?($(".fsLegend").addClass("legendOut"),c.deletionsSlide(c,d),GitHUD.slideCounter+=1):($(".fsLegend").addClass("legendOut"),c.drawLinechart(),GitHUD.slideCounter=1)},5e3)):"stop"==$(event.target).data("slideshow")&&(console.log("stop slideshow"),clearInterval(window.intId),clearInterval(window.repoSlideshowInt),$(".ss-pause").css("display","none"),$(".ss-play").css("display","inline-block"))},navigateSlide:function(a){var b=JST["app/templates/fullscreen-linechart.html"]({repo:this.model});if("next"==$(a.target).data("slideshow")){console.log("next slide");var c=GitHUD.slideCounter;switch(c){case 1:console.log("nav to additionsSlide"),$(".legend-destination").html(""),$(".linechart-destination").html(""),this.additionsSlide(that,b),GitHUD.slideCounter+=1;break;case 2:console.log("nav to deletionsSlide"),$(".legend-destination").html(""),$(".linechart-destination").html(""),this.deletionsSlide(that,b),GitHUD.slideCounter+=1;break;case 3:console.log("nav to commitsSlide"),$(".legend-destination").html(""),$(".linechart-destination").html(""),this.drawLinechart(that,b),GitHUD.slideCounter=1}}else if("previous"==$(a.target).data("slideshow"))switch(console.log("previous slide"),GitHUD.slideCounter){case 3:console.log("nav to additionsSlide,",GitHUD.slideCounter),$(".legend-destination").html(""),$(".linechart-destination").html(""),this.additionsSlide(that,b),GitHUD.slideCounter-=1;break;case 1:console.log("nav to deletionsSlide",GitHUD.slideCounter),$(".legend-destination").html(""),$(".linechart-destination").html(""),this.deletionsSlide(that,b),GitHUD.slideCounter=3;break;case 2:console.log("nav to commitsSlide",GitHUD.slideCounter),$(".legend-destination").html(""),$(".linechart-destination").html(""),this.drawLinechart(that,b),GitHUD.slideCounter-=1}},navigateRepos:function(a){(a.navTo="next-repo")?(console.log("next repo"),this.exitFullscreen(),$("#"+this.navObj.nextElemId).find("#fullscreen").click()):"previous-repo"==$(event.target).data("slideshow")&&(console.log("previous repo"),this.exitFullscreen(),$("#"+this.navObj.previousElemId).find("#fullscreen").click())},repoSlideshow:function(){var a=this;window.repoSlideshowInt=setInterval(function(){$(".fullscreen-stage").find("canvas").remove(),a.navigateRepos({navTo:"next-repo"})},3e4)}}),GitHUD.Views.RepoView=Backbone.View.extend({className:"repo",events:{"click #fullscreen":"initFullscreen"},initialize:function(){$(".donut-stage").append(this.el),this.listenTo(this.model,"change",function(a){this.$el.attr("id","repo-"+this.model.get("id")),this.render(a)}),this.fetchFx(),this.model.set("userColor",GitHUD.utilities.color(this.model.get("owner").login),{silent:!0})},fetchFx:function(){var a=this;this.model.fetch({success:function(b,c,d){switch(d.xhr.status){case 200:break;case 202:console.log("bad status: ",d.xhr.status),a.reFetchOnError();break;case 401:$("#donut-stage").html(""),new GitHUD.Views.WelcomeView}}})},reFetchOnError:function(){var a=this;window.fetchInt=setInterval(function(){a.model.fetch({success:function(a,b,c){switch(c.xhr.status){case 200:clearInterval(window.fetchInt);break;case 202:console.log("bad fetch, re-fetching")}}})},500)},render:function(){this.model.get("gitHUDMeta"),this.model.get("gitHUDMeta").sortData.contribCount>1&&this.$el.addClass("multi-contrib"),renderedTemplate=JST["app/templates/repo.html"]({repo:this.model}),this.$el.append(renderedTemplate),sortingInfo=JST["app/templates/sorting-info.html"],this.$el.append(sortingInfo({sortData:this.model.get("gitHUDMeta").sortData}));var a=$("#donut-chart-"+this.model.get("id")).get(0).getContext("2d");new Chart(a).Doughnut(this.model.get("gitHUDMeta").donutData,{animateRotate:!1});var b=$("#line-chart-"+this.model.get("id")).get(0).getContext("2d");_.extend(this.model.get("gitHUDMeta").graphData.truncatedWeeklyData.datasets[0],{fillColor:this.model.get("userColor"),strokeColor:this.model.get("userColor"),pointColor:GitHUD.utilities.colorLuminance(this.model.get("userColor"),-.25),pointStrokeColor:"#fff"}),_.extend(this.model.get("gitHUDMeta").fsLinechart.additions.datasets[0],{fillColor:this.model.get("userColor"),strokeColor:this.model.get("userColor"),pointColor:GitHUD.utilities.colorLuminance(this.model.get("userColor"),-.25),pointStrokeColor:"#fff"}),_.extend(this.model.get("gitHUDMeta").fsLinechart.deletions.datasets[0],{fillColor:this.model.get("userColor"),strokeColor:this.model.get("userColor"),pointColor:GitHUD.utilities.colorLuminance(this.model.get("userColor"),-.25),pointStrokeColor:"#fff"});var c=_.max(this.model.get("gitHUDMeta").graphData.truncatedWeeklyData.datasets[0].data,function(a){return a});c>9?new Chart(b).Line(this.model.get("gitHUDMeta").graphData.truncatedWeeklyData,{scaleShowGridLines:!1,animation:!1,scaleSteps:5,scaleStepWidth:Math.floor(c/5),scaleStartValue:0,scaleOverride:!0,animation:!1}):new Chart(b).Line(this.model.get("gitHUDMeta").graphData.truncatedWeeklyData,{scaleShowGridLines:!1,scaleSteps:5,scaleStepWidth:2,scaleStartValue:0,scaleOverride:!0,animation:!1})},initFullscreen:function(a){var b={},c=$(a.target).parent();b.nextElemId=$(c).next().attr("id"),b.previousElemId=$(c).prev().attr("id"),new GitHUD.Views.FullScreenView({model:this.model,navObj:b})}}),GitHUD.Views.IndexView=Backbone.View.extend({initialize:function(a){userList=_.map(_.uniq(a.users),function(a){return{username:a}}),this.users=new GitHUD.Collections.UserCollection(userList),this.users.on("change",function(a){_.each(a.get("repos"),function(a){a.fork===!1&&new GitHUD.Views.RepoView({model:new GitHUD.Models.Repo(a)})})}),this.users.each(function(a){a.fetch({success:function(a,b,c){switch(c.xhr.status){case 200:console.log("successful fetch!");break;case 401:$("#donut-stage").html(""),new GitHUD.Views.WelcomeView}}})}),$(".wrapper").append(this.el),this.render()},render:function(){}}),GitHUD.Views.WelcomeView=Backbone.View.extend({welcomeTemplate:JST["app/templates/welcome.html"],gettingStartedTemplate:JST["app/templates/gettingStarted.html"],className:"welcome-view",events:{"click #getting-started-add-users":"destroyView"},initialize:function(){options=this.options||{},$("#sort-by").hide(),this.render(),$("#donut-stage").append(this.el)},render:function(){docCookies.getItem("access_token")?(console.log("getting started view displayed"),this.$el.html(""),$("#sort-by").show(),this.$el.append(this.gettingStartedTemplate())):(this.$el.append(this.welcomeTemplate()),console.log("rendering welcome view"))},destroyView:function(){this.el.remove()}}),GitHUD.Views.MenuView=Backbone.View.extend({menuTemplate:JST["app/templates/menu.html"],modalTemplate:JST["app/templates/modal.html"],userInputTemplate:JST["app/templates/username-input.html"],className:"menu",isotopeReady:!1,events:{"click #sort-by button":"isotopeSort","click #filter-by":"isotopeFilter","click #submit-user-request":"createUrl","click #add-more-user-inputs":"addInput"},initialize:function(){$(".wrapper").prepend(this.el),this.render()},render:function(){this.$el.append(this.menuTemplate()),this.$el.append(this.modalTemplate())},createUrl:function(){var a="/?repos=";this.$el.find("#addusers input").each(function(){var b=$(this).val();b&&(a+=$(this).val()+",")}),GitHUD.router.navigate(a.slice(0,-1),{trigger:!0})},addInput:function(){this.$el.find(".modal-body").append(this.userInputTemplate())},toggleActive:function(a){"add-user-btn"!=$(a.target).parent().attr("id")&&"add-user-btn"!=$(a.target).attr("id")&&($(".menu-button").removeClass("active"),$(a.currentTarget).addClass("active"))},isotopeInit:function(){this.isotopeReady=!0,$("#donut-stage").isotope({sortAscending:!1,getSortData:{commits:function(a){return parseInt(a.find(".commits").text())},contributors:function(a){return a.find(".contributors").text()},additions:function(a){return a.find(".additions").text()},deletions:function(a){return a.find(".deletions").text()},size:function(a){return parseInt(a.find(".size").text())}}})},isotopeSort:function(a){if(this.isotopeReady||this.isotopeInit(),this.toggleActive(a),"sort"==$(a.target).data("isotope")){var b=$(a.currentTarget).attr("id").replace("sort-","");$("#donut-stage").isotope("reloadItems").isotope({sortBy:b})}},isotopeFilter:function(a){var b=$(a.currentTarget).attr("data-filter");$("#donut-stage").isotope({filter:b})}}),AppRouter=Backbone.Router.extend({initialize:function(){this.menuView=new GitHUD.Views.MenuView},routes:{"":"mainRoute"},mainRoute:function(a){that=this,docCookies.getItem("access_token")?(GitHUD.access_token=docCookies.getItem("access_token"),a&&a.repos?(new GitHUD.Views.IndexView({users:a.repos.split(",")}),console.log("showing repos!")):new GitHUD.Views.WelcomeView({auth:!0})):a&&a.code?$.getJSON("http://githud-auth.herokuapp.com/authenticate/"+a.code,function(a){docCookies.setItem("access_token",a.token,"Tue, 06 Dec 2022 13:11:07 GMT"),GitHUD.access_token=docCookies.getItem("access_token"),$(".login").hide(),$(".logout").show(),that.navigate("")}):a||(new GitHUD.Views.WelcomeView({auth:!1}),console.log("show welcome!"))}}),$(function(){GitHUD.router=new AppRouter,Backbone.history.start({pushState:!0,root:"/"})});